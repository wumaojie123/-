(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-53cc"],{IM6w:function(e,t,a){},"SI/Q":function(e,t,a){"use strict";var n=a("IM6w");a.n(n).a},"mG/D":function(e,t,a){"use strict";a.d(t,"c",function(){return n}),a.d(t,"d",function(){return r}),a.d(t,"b",function(){return i}),a.d(t,"a",function(){return s}),a.d(t,"e",function(){return l});var n=[{value:"CDZ",label:"充电桩"},{value:"SHJ",label:"售货机"}],r={CDZ:"充电桩",SHJ:"售货机"},i={0:"无",1:"脉冲",2:"串口"},s=[{name:"商场",value:"Mall_Aisle"},{name:"电影院",value:"Cinema"},{name:"KTV",value:"KTV"},{name:"游艺厅",value:"Games_Hall"},{name:"酒店",value:"MALL,002"},{name:"步行街",value:"MALL,004"},{name:"4S店",value:"MALL,003"},{name:"旅游景点",value:"SCENIC_SPOT,001"},{name:"机场",value:"STATION,001"},{name:"火车站",value:"STATION,002"},{name:"汽车站",value:"STATION,003"},{name:"地铁站",value:"STATION,004"},{name:"工厂",value:"FACTORY,001"},{name:"社区",value:"COMMUNITY,001"},{name:"办公楼",value:"OFFICE,001"},{name:"医院",value:"HOSPITAL,001"},{name:"政府机构",value:"GOVERNMENT,001"},{name:"大学",value:"SCHOOL,005"},{name:"初中",value:"SCHOOL,003"},{name:"小学",value:"SCHOOL,002"},{name:"幼儿园",value:"SCHOOL,001"},{name:"培训机构",value:"SCHOOL,006"},{name:"高中&职业技术学院",value:"SCHOOL,004"},{name:"其他",value:"OTHERS,001"}],l=[{value:3,label:"自动售货机"},{value:1,label:"福袋机"},{value:2,label:"口红机"},{value:4,label:"冰淇淋机"},{value:8,label:"电子烟售货机"},{value:11,label:"豆浆机"},{value:12,label:"咖啡机"},{value:13,label:"格子机"}]},miVi:function(e,t,a){"use strict";a.r(t);var n=a("14Xm"),r=a.n(n),i=a("D3Ub"),s=a.n(i),l=a("qpgI"),o=a("mG/D"),u={data:function(){return{queryParams:{equipmentType:"CDZ",equipmentValue:"",registered:0},equipmentTypesArr:o.c,list:[],colums:[{key:"equipmentTypeText",label:"设备类型"},{key:"value",label:"设备编号"},{key:"communicationText",label:"通信方式"},{key:"chargePattern",label:"计费方式"},{key:"protocolDTOTitle",label:"设备型号"},{key:"sourceText",label:"设备来源"},{key:"updated",label:"操作时间"}],shjColums:[{key:"equipmentTypeText",label:"设备类型"},{key:"value",label:"设备编号"},{key:"communicationText",label:"通信方式"},{key:"distributor",label:"商家名称"},{key:"protocolDTOTitle",label:"设备型号"},{key:"sourceText",label:"设备来源"},{key:"updated",label:"操作时间"}],pageInfo:{total:0,pageSize:10,currPage:1},selectList:[],showPatternBoxFlag:!1,arrCDZDiaologContent:{TIME:"充电时长计算充电费用，如1元240分钟",ELEC:"电量消耗计算充电费用，如1元1度"},arrCDZChargePattern:[],tempChargePattern:"",selectedPattern:"",tempEquipmentArr:[],tableHeight:700}},created:function(){this.initTableHeight(),this.queryList()},methods:{initTableHeight:function(){var e=this;this.$nextTick(function(){var t=document.querySelector(".main-container").offsetHeight,a=document.querySelector(".el-form").offsetHeight;e.tableHeight=t>0?t-a-180:700})},changeDeviceType:function(e){this.queryParams.equipmentType=e,this.queryList()},getChargePatternText:function(e){var t="";return(e=e||[]).forEach(function(e){t+=e.description+","}),""!==t&&(t=t.substr(0,t.length-1)),t},queryList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return s()(r.a.mark(function a(){var n,i,s,u;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(i in e.selectList=[],e.list=[],e.pageInfo.currPage=t,n={pageSize:e.pageInfo.pageSize,pageIndex:e.pageInfo.currPage},e.queryParams)n[i]=e.queryParams[i];return a.next=7,Object(l.r)(n);case 7:0===(s=a.sent).result&&(e.listLoading=!1,s.data?(u=(u=s.data.items||[]).map(function(t){t.sourceText=1===t.source?"商家解绑":0===t.source?"平台导入":"",t.communicationText=o.b[t.communication];var a=o.d;t.equipmentTypeText=a[t.equipmentType],2===t.communication?t.chargePattern=e.getChargePatternText(t.billingModel):t.chargePattern="--";var n=t.protocolDTO&&t.protocolDTO.title||"";return t.protocolDTOTitle=n,t}),e.list=u,e.pageInfo.total=s.data.total||0):e.pageInfo.total=0);case 9:case"end":return a.stop()}},a,e)}))()},handleSelectionChange:function(e){this.selectList=e},getTemplateRow:function(e){this.check=e,this.selectList=[this.list[e]]},handleSizeChange:function(e){this.pageInfo.pageSize=e,this.pageInfo.total=0,this.queryList(1)},handleCurrentChange:function(e){this.queryList(e)},filerQueryList:function(){this.pageInfo.total=0,this.queryList(this.pageInfo.currPage)},setChargePattern:function(e){this.tempChargePattern=e},sureChargePattern:function(){this.showPatternBoxFlag=!1,this.$router.push({path:"/register",query:{deviceType:this.queryParams.equipmentType,equipmentArr:this.tempEquipmentArr,communication:2,chargePattern:this.tempChargePattern}})},handleRegister:function(){if(0!==this.selectList.length){var e=[],t=[],a=[];if(this.selectList.forEach(function(n){e.push(n.value),t.push(n.communication),a.push({type:n.equipmentType,name:n.distributor,id:n.lyyDistributorId})}),"SHJ"===this.queryParams.equipmentType){var n=a.some(function(e){return e.type!==a[0].type}),r=a.some(function(e){return e.name!==a[0].name}),i=a.every(function(e){return!!e.id});if(n)return void this.$message({message:"无法批量注册不同的设备类型",type:"error"});if(r)return void this.$message({message:"无法批量给不同的商家注册设备",type:"error"});if(!i)return void this.$message({message:"存在未转移设备，请转移",type:"error"})}else{if(t.some(function(e){return e!==t[0]}))return void this.$message({message:"只能选择同一种通信方式的设备进行注册",type:"error"})}if(2===t[0]){var s=this.checkChargePattern();if(-1!==s.TIME&&-1!==s.ELEC)return void this.$message({message:"只能选择相同计费模式设备进行注册",type:"error"});-1===s.TIME&&-1===s.ELEC?this.selectedPattern="TWO":this.selectedPattern=-1===s.TIME?"ELEC":"TIME"}else this.selectedPattern="";"TWO"===this.selectedPattern?(this.showPatternBoxFlag=!0,this.tempEquipmentArr=e):this.$router.push({path:"/register",query:{deviceType:this.queryParams.equipmentType,equipmentArr:e,communication:t[0],distributorId:String(this.selectList[0].lyyDistributorId),lyyEquipmentTypeId:this.selectList[0].lyyEquipmentTypeId,account:this.selectList[0].account,distributor:this.selectList[0].distributor,chargePattern:this.selectedPattern}})}else this.$message({message:"请选择要注册的设备",type:"error"})},checkChargePattern:function(){var e=this,t={TIME:-1,ELEC:-1,TWO:-1};return this.arrCDZChargePattern=[],this.selectList.forEach(function(a){a.billingModel.length>1&&(t.TWO=0,0===e.arrCDZChargePattern.length&&a.billingModel.forEach(function(t){e.arrCDZChargePattern.push(t.name)})),1===a.billingModel.length&&t[a.billingModel[0].name]++}),t},handleUpdateModel:function(){0!==this.selectList.length?this.selectList.length>1?this.$message({message:"修改设备型号只支持单选",type:"error"}):1e4===this.selectList[0].loginFlag&&this.selectList[0].communicationText?this.$router.push({path:"/deviceModify",query:{lyyEquipmentId:this.selectList[0].lyyEquipmentId,value:this.selectList[0].value,equipmentType:this.selectList[0].equipmentType,type:0}}):this.$message({message:"请选择设备型号不为空的设备",type:"warning"}):this.$message({message:"请选择要修改协议的设备",type:"error"})}}},c=(a("SI/Q"),a("KHd+")),p=Object(c.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-area"},[a("el-form",{staticStyle:{"margin-bottom":"20px"},attrs:{inline:!0,"label-width":"90px","label-position":"right"}},[a("el-form-item",{attrs:{label:"设备类型"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeDeviceType},model:{value:e.queryParams.equipmentType,callback:function(t){e.$set(e.queryParams,"equipmentType",t)},expression:"queryParams.equipmentType"}},e._l(e.equipmentTypesArr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"设备编号"}},[a("el-input",{staticClass:"input-300",attrs:{placeholder:"输入多台设备时用,隔开",maxlength:"100",clearable:""},model:{value:e.queryParams.equipmentValue,callback:function(t){e.$set(e.queryParams,"equipmentValue",t)},expression:"queryParams.equipmentValue"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.filerQueryList}},[e._v("查询")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:e.handleUpdateModel}},[e._v("修改设备型号")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:e.handleRegister}},[e._v("设备注册")]),e._v(" "),a("router-link",{attrs:{to:{path:"/registerRecord"}}},[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success"}},[e._v("设备注册记录")])],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{height:e.tableHeight,data:e.list,border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),"CDZ"===e.queryParams.equipmentType?e._l(e.colums,function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.key,label:e.label,width:e.width,sortable:e.sortable,align:"center"}})}):e._e(),e._v(" "),"SHJ"===e.queryParams.equipmentType?e._l(e.shjColums,function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.key,label:e.label,width:e.width,sortable:e.sortable,align:"center"}})}):e._e()],2),e._v(" "),a("div",{staticStyle:{"padding-bottom":"10px","font-size":"16px"}},[e._v("合计设备数："+e._s(e.pageInfo.total)+"台")]),e._v(" "),a("el-pagination",{attrs:{"page-sizes":[10,20,30,40],"page-size":e.pageInfo.pageSize,total:e.pageInfo.total,"current-page":e.pageInfo.currPage,background:"",layout:"total, prev, pager, next, sizes, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showPatternBoxFlag,expression:"showPatternBoxFlag"}],staticClass:"s-charge-pattern-panel"},[a("div",{staticClass:"s-charge-pattern-box"},[a("div",{staticClass:"title"},[e._v("请选择服务套餐计费模式")]),e._v(" "),a("div",{staticClass:"s-sel-charge-pattern"},[e._l(e.arrCDZChargePattern,function(t,n){return[a("div",{key:n,class:["charge-pattern-box"," time-pattern",{active:t==e.tempChargePattern}],on:{click:function(a){e.setChargePattern(t)}}},[a("div",{staticClass:"icon"}),e._v(" "),a("div",{staticClass:"pattern-content"},[e._v("\n              "+e._s("ELEC"===t?"按电量计费":"按时长计费")+"\n              "),a("p",[e._v(e._s(e.arrCDZDiaologContent[t]))])])])]})],2),e._v(" "),a("div",{staticClass:"btn-panel"},[a("div",{staticClass:"no-scroll cancel-btn",on:{click:function(t){e.showPatternBoxFlag=!1}}},[e._v("取消")]),e._v(" "),a("div",{staticClass:"no-scroll sure-btn",on:{click:e.sureChargePattern}},[e._v("确定")])])])])],1)},[],!1,null,"14622482",null);p.options.__file="deviceUnregister.vue";t.default=p.exports}}]);