(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5834","YKrQ"],{"8Reg":function(e,t,i){"use strict";var a=i("V2su");i.n(a).a},B5LO:function(e,t,i){"use strict";i.d(t,"e",function(){return n}),i.d(t,"b",function(){return r}),i.d(t,"c",function(){return l}),i.d(t,"d",function(){return s}),i.d(t,"a",function(){return o});var a=i("Yfch"),n=function(e,t,i){if(!t||t&&!Object(a.d)(t))return i(new Error("请输入正确的11位手机号码"));i()},r=function(e,t,i){if(t&&!/^[A-Za-z0-9]{6,16}$/.test(t))return i(new Error("请输入6-16位的数字或字母"));i()},l=function(e,t,i){if(!/^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/.test(t)||t>1e4)return i(new Error("价格必须为大于0的正数,价格需小于10000,最多保留2位小数"));i()},s=function(e,t,i){if(!/^([1-9][0-9]*)$/.test(t)||t>1440)return i(new Error("服务时间必须为大于0的小于等于1440(24小时)正整数"));i()},o=function(e,t,i){if(!/^([1-9][0-9]*)$/.test(t)||0===t||t>1e4)return i(new Error("模拟投币数必须为大于0的整数"));i()}},PvNR:function(e,t,i){"use strict";i.r(t);var a=i("gDS+"),n=i.n(a),r=i("14Xm"),l=i.n(r),s=i("D3Ub"),o=i.n(s),c=i("qpgI"),u=i("B5LO"),d=function(e,t,i){/^-?\d+\.?\d{0,1}$/.test(t)&&t<50&&t>0?i():i(new Error("电量必须为大于0的正数，电量需小于50，最多一位小数"))},p={components:{verfyCode:i("YKrQ").default},data:function(){return{lyyDistributorId:"",list:[],pageInfo:{total:0,pageSize:10,pageIndex:1},selectList:[],dialogFormVisible:!1,lyyEquipmentId:"",modalData:{description:"",price:"",coins:"",serviceTime:"",electric:""},lyyDistributorList:[],baseInfoRules:{description:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],serviceTime:[{required:!0,validator:u.d,trigger:"blur"}],coins:[{required:!0,validator:u.a,trigger:"blur"}],price:[{required:!0,validator:u.c,trigger:"blur"}],electric:[{required:!0,message:"请输入电量",trigger:"change"},{validator:d}]},type:"",communication:"",verfyCodeVisible:!1,phoneNumber:"",name:"",actionType:"",handleItemData:{},lyyEquipmentValue:"",defineBillingMap:[{label:"按时长计费",val:"TIME"},{label:"按电量计费",val:"ELEC"}],billingMap:[],billing:"TIME",tempBilling:""}},computed:{colums:function(){return 2!==this.communication?[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"serviceTime",label:"时长(分钟)"},{key:"coins",label:"模拟投币数"}]:"ELEC"===this.billing?[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"electric",label:"电量(度)"}]:[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"serviceTime",label:"时长(分钟)"}]}},created:function(){this.lyyEquipmentId=this.$route.query.lyyEquipmentId,this.lyyEquipmentValue=this.$route.query.value,this.communication=parseInt(this.$route.query.communication,10),this.phoneNumber=this.$route.query.phoneNumber,this.name=this.$route.query.name,this.billing=this.$route.query.billing,this.tempBilling=this.billing,this.queryList()},methods:{onClose:function(){this.dialogFormVisible=!1,this.verfyCodeVisible=!1,this.$refs.baseInfoRules.resetFields()},setBilling:function(){var e=this,t=this.billing;this.billing!==this.tempBilling&&(this.billing=this.tempBilling,this.$confirm("切换计费方式后，将会清空服务套餐","温馨提示").then(function(){e.updateChargePattern(t)}).catch(function(){}))},queryChargePattern:function(){var e=this;return o()(l.a.mark(function t(){var i,a,n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={equipmentValue:e.lyyEquipmentValue},t.next=3,Object(c.g)(i);case 3:0===(a=t.sent).result&&(n=a.data||[],e.billingMap=[],n.forEach(function(t){e.billingMap.push({label:t.description,val:t.name})}),1===e.billingMap.length&&e.billingMap[0].val!==e.billing&&e.$confirm("设备所支持的计费方式发生变更，请重新设置服务套餐","温馨提示",{showCancelButton:!1,showClose:!1,closeOnClickModal:!1}).then(function(t){t&&e.updateChargePattern(e.billingMap[0].val)}));case 5:case"end":return t.stop()}},t,e)}))()},updateChargePattern:function(e){var t=this;return o()(l.a.mark(function i(){var a,n;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a={equipmentValue:t.lyyEquipmentValue,groupServiceCostWay:e},i.next=3,Object(c.w)(a);case 3:0===(n=i.sent).result&&0===n.data?(t.billing=e,t.tempBilling=t.billing,t.list=[]):t.$message({message:"更新计费模式失败",type:"error"});case 5:case"end":return i.stop()}},i,t)}))()},queryList:function(){var e=this;return o()(l.a.mark(function t(){var i,a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.list=[],i={lyyEquipmentId:e.lyyEquipmentId,pageSize:e.pageInfo.pageSize,pageIndex:e.pageInfo.pageIndex},t.next=4,Object(c.h)(i);case 4:a=t.sent,2===e.communication&&e.queryChargePattern(),0===a.result&&(e.listLoading=!1,a.data?(e.list=a.data.items||[],e.pageInfo.total=a.data.total||0):e.pageInfo.total=0);case 7:case"end":return t.stop()}},t,e)}))()},handleSelectionChange:function(e){this.actionType="add",this.verfyCodeVisible=!1,this.type="modify",this.modalData=JSON.parse(n()(e)),this.dialogFormVisible=!0},handleSaveModal:function(){this.type="add",this.actionType="add",this.dialogFormVisible=!0,this.modalData={description:"",price:"",coins:"",serviceTime:"",electric:""}},handleSaveBefore:function(){var e,t=this;this.$refs.baseInfoRules.validate((e=o()(l.a.mark(function e(i){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i&&(t.verfyCodeVisible=!0);case 1:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},handleCheck:function(){"add"===this.actionType?this.handleSave():(this.verfyCodeVisible=!1,this.delService())},handleSave:function(){var e,t=this;this.$refs.baseInfoRules.validate((e=o()(l.a.mark(function e(i){var a,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=23;break}if(a={serviceTime:t.modalData.serviceTime,lyyEquipmentId:t.lyyEquipmentId},1===t.communication&&(a.coins=t.modalData.coins),"add"!==t.type){e.next=13;break}return n=t.modalData,2===t.communication&&("ELEC"!==t.billing?n.coins=n.serviceTime:(n.serviceTime=Math.round(100*n.electric),n.coins=n.serviceTime)),n.lyyEquipmentId=t.lyyEquipmentId,e.next=9,Object(c.o)(n);case 9:0===e.sent.result?(t.verfyCodeVisible=!1,t.$message({message:"添加服务套餐成功",type:"success"}),t.queryList(1),t.dialogFormVisible=!1):t.$message({message:"添加服务套餐失败",type:"error"}),e.next=21;break;case 13:if("modify"!==t.type){e.next=21;break}return r=t.modalData,2===t.communication&&("ELEC"!==t.billing?r.coins=r.serviceTime:(r.serviceTime=Math.round(100*r.electric),r.coins=r.serviceTime)),r.lyyEquipmentId=t.lyyEquipmentId,e.next=19,Object(c.x)(r);case 19:0===e.sent.result&&(t.verfyCodeVisible=!1,t.$message({message:"更新服务套餐成功",type:"success"}),t.queryList(1),t.dialogFormVisible=!1);case 21:e.next=24;break;case 23:return e.abrupt("return",!1);case 24:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},handleBatchSave:function(){var e=this;return o()(l.a.mark(function t(){var i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.selectList.length){t.next=3;break}return e.$message({message:"请至少选择一个服务套餐",type:"error"}),t.abrupt("return");case 3:return i={communication:e.communication,equipmentType:e.deviceType,values:e.equipmentArr,lyyDistributorId:e.lyyDistributorId},t.next=6,Object(c.b)(i);case 6:0===t.sent.result&&e.$message({message:"请至少选择一个服务套餐",type:"error"});case 8:case"end":return t.stop()}},t,e)}))()},delServiceBefore:function(e){this.verfyCodeVisible=!0,this.actionType="del",this.handleItemData=JSON.pase(n()(e))},delService:function(){var e=this;this.$confirm("确定要删除该服务套餐吗？","删除服务套餐").then(o()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(c.e)({lyyGroupServiceId:e.handleItemData.lyyGroupServiceId,lyyEquipmentId:e.lyyEquipmentId});case 2:0===t.sent.result?(e.$message({message:"删除套餐成功",type:"success"}),e.queryList(1)):e.$message({message:"删除套餐失败",type:"error"});case 4:case"end":return t.stop()}},t,e)})))},handleSizeChange:function(e){this.pageInfo.pageSize=e,this.pageInfo.total=0,this.queryList(1)},handleCurrentChange:function(e){this.queryList(e)}}},m=(i("8Reg"),i("KHd+")),f=Object(m.a)(p,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content-area"},[i("div",{staticClass:"table-title-info"},[i("span",[e._v("设备编号:"+e._s(e.lyyEquipmentValue))]),e._v(" "),2==e.communication?[i("el-select",{attrs:{disabled:e.billingMap.length<=1},on:{change:e.setBilling},model:{value:e.billing,callback:function(t){e.billing=t},expression:"billing"}},e._l(e.defineBillingMap,function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.val}})}))]:e._e(),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveModal}},[e._v("添加套餐")])],2),e._v(" "),i("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.list,border:"","highlight-current-row":"",height:"500"},on:{"selection-change":e.handleSelectionChange}},[e._l(e.colums,function(e,t){return i("el-table-column",{key:t,attrs:{prop:e.key,label:e.label,width:e.width,sortable:e.sortable,align:"center"}})}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleSelectionChange(t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.delServiceBefore(t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),i("el-pagination",{attrs:{"page-sizes":[10,20,30,40],"page-size":e.pageInfo.pageSize,total:e.pageInfo.total,"current-page":e.pageInfo.currPage,background:"",layout:"total, prev, pager, next, sizes, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"编辑套餐服务",width:"35%"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.onClose}},[i("el-form",{ref:"baseInfoRules",staticStyle:{"margin-top":"20px"},attrs:{model:e.modalData,rules:e.baseInfoRules,"label-width":"120px","label-position":"right"}},[i("el-form-item",{attrs:{label:"套餐名称",prop:"description"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入套餐名称",maxlength:"10"},model:{value:e.modalData.description,callback:function(t){e.$set(e.modalData,"description",t)},expression:"modalData.description"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"价格(元)",prop:"price"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入价格",type:"number",maxlength:"7",clearable:""},model:{value:e.modalData.price,callback:function(t){e.$set(e.modalData,"price",t)},expression:"modalData.price"}})],1),e._v(" "),"ELEC"==e.billing?i("el-form-item",{key:"ELEC",attrs:{label:"电量(度)",prop:"electric"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入电量",clearable:""},model:{value:e.modalData.electric,callback:function(t){e.$set(e.modalData,"electric",t)},expression:"modalData.electric"}})],1):e._e(),e._v(" "),"ELEC"!==e.billing?i("el-form-item",{key:"TIME",attrs:{label:"时长(分钟)",prop:"serviceTime"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入时长",type:"tel",maxlength:"4",clearable:""},model:{value:e.modalData.serviceTime,callback:function(t){e.$set(e.modalData,"serviceTime",t)},expression:"modalData.serviceTime"}})],1):e._e(),e._v(" "),2!=e.communication?[i("el-form-item",{attrs:{label:"模拟投币数",prop:"coins"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入模拟投币数",type:"number",maxlength:"4",clearable:""},model:{value:e.modalData.coins,callback:function(t){e.$set(e.modalData,"coins",t)},expression:"modalData.coins"}})],1)]:e._e()],2),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.onClose}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveBefore}},[e._v("保存并使用")])],1)],1),e._v(" "),i("verfyCode",{attrs:{"phone-number":e.phoneNumber,name:e.name},on:{"on-OK":e.handleCheck},model:{value:e.verfyCodeVisible,callback:function(t){e.verfyCodeVisible=t},expression:"verfyCodeVisible"}})],1)},[],!1,null,null,null);f.options.__file="deviceServiceEdit.vue";t.default=f.exports},V2su:function(e,t,i){},YKrQ:function(e,t,i){"use strict";i.r(t);var a=i("14Xm"),n=i.n(a),r=i("D3Ub"),l=i.n(r),s=i("qpgI"),o={props:{value:{type:Boolean,default:!1},phoneNumber:{type:String,default:""},name:{type:String,default:""}},data:function(){return{verifyCode:"",disabled:!0}},computed:{info:function(){return this.name+"-"+this.phoneNumber}},methods:{handleSend:function(){var e=this;return l()(n.a.mark(function t(){var i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.disabled){t.next=2;break}return t.abrupt("return");case 2:return e.disabled=!1,setTimeout(function(){e.disabled=!0},2e3),t.next=6,Object(s.z)({phoneNumber:e.phoneNumber});case 6:i=t.sent,e.disabled=!0,0===i.result?e.$message({message:"获取短信验证码成功",type:"success"}):e.$message({message:"获取短信验证码失败",type:"error"});case 9:case"end":return t.stop()}},t,e)}))()},handleCancel:function(){this.disabled=!0,this.$emit("input",!1)},handleOK:function(){this.verifyCode?this.handlevalidate():this.$message({message:"请输入短信验证码",type:"error"})},handlevalidate:function(){var e=this;return l()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(s.y)({phoneNumber:e.phoneNumber,verifyCode:e.verifyCode});case 2:0===t.sent.result?(e.disabled=!0,e.$emit("on-OK")):e.$message({message:"短信验校验失败",type:"success"});case 4:case"end":return t.stop()}},t,e)}))()}}},c=i("KHd+"),u=Object(c.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.value,"close-on-click-modal":!1,title:"操作验证",width:"45%"},on:{"update:visible":function(t){e.value=t}}},[i("el-form",{attrs:{"label-width":"120px","label-position":"right"}},[i("el-form-item",{attrs:{label:"设备所属商家",prop:"description"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入菜单名称",maxlength:"6",readonly:""},model:{value:e.info,callback:function(t){e.info=t},expression:"info"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"操作验证码",prop:"price"}},[i("el-input",{staticClass:"input-300",attrs:{type:"tel",clearable:"",maxlength:"6"},model:{value:e.verifyCode,callback:function(t){e.verifyCode=t},expression:"verifyCode"}}),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSend}},[e._v("获取验证码")])],1),e._v(" "),i("p",{staticStyle:{color:"red","margin-left":"120px"}},[e._v("请联系商家获取短信验证码")])],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleOK}},[e._v("确定")])],1)],1)},[],!1,null,null,null);u.options.__file="verfyCode.vue";t.default=u.exports}}]);