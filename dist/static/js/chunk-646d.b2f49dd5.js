(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-646d","YKrQ"],{B5LO:function(e,t,a){"use strict";a.d(t,"e",function(){return i}),a.d(t,"b",function(){return n}),a.d(t,"c",function(){return s}),a.d(t,"d",function(){return l}),a.d(t,"a",function(){return o});var r=a("Yfch"),i=function(e,t,a){if(!t||t&&!Object(r.d)(t))return a(new Error("请输入正确的11位手机号码"));a()},n=function(e,t,a){if(t&&!/^[A-Za-z0-9]{6,16}$/.test(t))return a(new Error("请输入6-16位的数字或字母"));a()},s=function(e,t,a){if(!/^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/.test(t)||t>1e4)return a(new Error("价格必须为大于0的正数,价格需小于10000,最多保留2位小数"));a()},l=function(e,t,a){if(!/^([1-9][0-9]*)$/.test(t)||t>1440)return a(new Error("服务时间必须为大于0的小于等于1440(24小时)正整数"));a()},o=function(e,t,a){if(!/^([1-9][0-9]*)$/.test(t)||0===t||t>1e4)return a(new Error("模拟投币数必须为大于0的整数"));a()}},YKrQ:function(e,t,a){"use strict";a.r(t);var r=a("cLjf"),i=a.n(r),n=a("hDQ3"),s=a.n(n),l=a("qpgI"),o={props:{value:{type:Boolean,default:!1},phoneNumber:{type:String,default:""},name:{type:String,default:""}},data:function(){return{verifyCode:"",disabled:!0}},computed:{info:function(){return this.name+"-"+this.phoneNumber}},methods:{handleSend:function(){var e=this;return s()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.disabled){t.next=2;break}return t.abrupt("return");case 2:return e.disabled=!1,setTimeout(function(){e.disabled=!0},2e3),t.next=6,Object(l.C)({phoneNumber:e.phoneNumber});case 6:a=t.sent,e.disabled=!0,0===a.result?e.$message({message:"获取短信验证码成功",type:"success"}):e.$message({message:"获取短信验证码失败",type:"error"});case 9:case"end":return t.stop()}},t,e)}))()},handleCancel:function(){this.disabled=!0,this.$emit("input",!1)},handleOK:function(){this.verifyCode?this.handlevalidate():this.$message({message:"请输入短信验证码",type:"error"})},handlevalidate:function(){var e=this;return s()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(l.B)({phoneNumber:e.phoneNumber,verifyCode:e.verifyCode});case 2:0===t.sent.result?(e.disabled=!0,e.$emit("on-OK")):e.$message({message:"短信验校验失败",type:"success"});case 4:case"end":return t.stop()}},t,e)}))()}}},c=a("ZrdR"),u=Object(c.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.value,"close-on-click-modal":!1,title:"操作验证",width:"45%"},on:{"update:visible":function(t){e.value=t}}},[a("el-form",{attrs:{"label-width":"120px","label-position":"right"}},[a("el-form-item",{attrs:{label:"设备所属商家",prop:"description"}},[a("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入菜单名称",maxlength:"6",readonly:""},model:{value:e.info,callback:function(t){e.info=t},expression:"info"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"操作验证码",prop:"price"}},[a("el-input",{staticClass:"input-300",attrs:{type:"tel",clearable:"",maxlength:"6"},model:{value:e.verifyCode,callback:function(t){e.verifyCode=t},expression:"verifyCode"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSend}},[e._v("获取验证码")])],1),e._v(" "),a("p",{staticStyle:{color:"red","margin-left":"120px"}},[e._v("请联系商家获取短信验证码")])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleOK}},[e._v("确定")])],1)],1)},[],!1,null,null,null);u.options.__file="verfyCode.vue";t.default=u.exports},"i/up":function(e,t,a){"use strict";var r=a("th1P");a.n(r).a},"mG/D":function(e,t,a){"use strict";a.d(t,"b",function(){return r}),a.d(t,"c",function(){return i}),a.d(t,"a",function(){return n});var r=[{value:"CDZ",label:"充电桩"}],i={CDZ:"充电桩"},n={0:"无",1:"脉冲",2:"串口"}},qBRV:function(e,t,a){"use strict";a.r(t);var r=a("nKCB"),i=a.n(r),n=a("LGhb"),s=a.n(n),l=(a("omC7"),a("cLjf")),o=a.n(l),c=a("hDQ3"),u=a.n(c),m=a("qpgI"),d=a("B5LO"),p=a("mG/D"),h=function(e,t,a){/^-?\d+\.?\d{0,1}$/.test(t)&&t<50&&t>0?a():a(new Error("电量必须为大于0的正数，电量需小于50，最多一位小数"))},f={components:{verfyCode:a("YKrQ").default},filters:{deviceFilter:function(e){return p.c[e]},communicationFilter:function(e){return p.a[e]}},data:function(){return{lyyDistributorId:"",list:[],colums:[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"serviceTime",label:"时长(分钟)"},{key:"coins",label:"模拟投币数"}],pageInfo:{total:0},selectList:[],dialogFormVisible:!1,deviceType:"",equipmentArr:[],communication:"",modalData:{description:"",price:"",coins:"",serviceTime:"",electric:""},merchantList:[],baseInfoRules:{description:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],serviceTime:[{required:!0,validator:d.d,trigger:"blur"}],coins:[{required:!0,validator:d.a,trigger:"blur"}],price:[{required:!0,validator:d.c,trigger:"blur"}],electric:[{required:!0,message:"请输入电量",trigger:"change"},{validator:h}]},clickDisabled:!1,verfyCodeVisible:!1,phoneNumber:"",name:"",chargePattern:""}},computed:{chargePatternText:function(){return"ELEC"===this.chargePattern?"按电量计费":"按时长计费"}},created:function(){this.deviceType=this.$route.query.deviceType,this.equipmentArr=this.$route.query.equipmentArr,this.communication=this.$route.query.communication,this.phoneNumber=this.$route.query.phoneNumber,this.name=this.$route.query.name,this.chargePattern=this.$route.query.chargePattern,2==this.communication&&("ELEC"===this.chargePattern?this.colums=[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"electric",label:"电量(度)"}]:this.colums=[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"serviceTime",label:"时长(分钟)"}]),this.queryList(),this.getMerchantList()},methods:{queryList:function(){var e=this;return u()(o.a.mark(function t(){var a,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.list=[],a={communication:e.communication,equipmentType:e.deviceType,pageSize:400,pageIndex:1},2===e.communication&&(a.billing="ELEC"===e.chargePattern?2:1),t.next=5,Object(m.a)(a);case 5:0===(r=t.sent).result&&(e.listLoading=!1,r.data?(e.list=r.data.items||[],e.pageInfo.total=r.data.total||0):e.pageInfo.total=0);case 7:case"end":return t.stop()}},t,e)}))()},getMerchantList:function(){var e=this;return u()(o.a.mark(function t(){var a,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.j)();case 2:0===(a=t.sent).result&&(r=(r=a.data||[]).map(function(e){return e.label=e.account+" "+e.name,e}),e.merchantList=r);case 4:case"end":return t.stop()}},t,e)}))()},handleSelectionChange:function(e){this.selectList=e},handleSaveModal:function(){this.dialogFormVisible=!0,this.modalData={description:"",price:"",coins:"",serviceTime:"",electric:""}},handleSave:function(){var e=this;this.$refs.baseInfoRules.validate(function(t){if(!t)return!1;if(e.list.some(function(t){return 1===e.communication&&parseInt(t.coins,10)===parseInt(e.modalData.coins,10)||2===e.communication&&"ELEC"!==e.chargePattern&&parseInt(t.serviceTime,10)===parseInt(e.modalData.serviceTime,10)||2===e.communication&&"ELEC"===e.chargePattern&&t.electric===e.modalData.electric})){var a="";return 1===e.communication?a="模拟投币数不可重复":2===e.communication&&(a="ELEC"===e.chargePattern?"电量不能重复":"时长不能重复"),void e.$message({message:a,type:"error"})}2===e.communication&&("ELEC"===e.chargePattern?(e.modalData.serviceTime=Math.round(100*e.modalData.electric),e.modalData.coins=e.modalData.serviceTime):e.modalData.coins=e.modalData.serviceTime),e.list=[e.modalData].concat(e.list),e.selectList.push(e.modalData),e.dialogFormVisible=!1})},isRepeat:function(){var e=this,t=[];return this.selectList.forEach(function(a){2===e.communication?"ELEC"===e.chargePattern?t.push(a.electric):t.push(a.serviceTime):1===e.communication&&t.push(a.coins)}),t.length===s()(new i.a(t)).length},handleBatchSaveBefore:function(){var e=this;if(0!==this.selectList.length)if(this.lyyDistributorId)if(this.isRepeat()){var t=this.merchantList.filter(function(t){return t.adOrgId===e.lyyDistributorId})[0];this.phoneNumber=t.account,this.name=t.name,this.handleSaveModal()}else this.$message({message:"服务套餐不可重复",type:"error"});else this.$message({message:"请选择要绑定的商家",type:"error"});else this.$message({message:"请至少选择一个服务套餐",type:"error"})},handleBatchSave:function(){var e=this;return u()(o.a.mark(function t(){var a,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.clickDisabled){t.next=2;break}return t.abrupt("return");case 2:if(0!==e.selectList.length){t.next=5;break}return e.$message({message:"请至少选择一个服务套餐",type:"error"}),t.abrupt("return");case 5:if(e.lyyDistributorId){t.next=8;break}return e.$message({message:"请选择要绑定的商家",type:"error"}),t.abrupt("return");case 8:if(e.isRepeat()){t.next=11;break}return e.$message({message:"服务套餐不可重复",type:"error"}),t.abrupt("return");case 11:return a=e.merchantList.filter(function(t){return t.adOrgId===e.lyyDistributorId})[0],e.phoneNumber=a.account,e.name=a.name,r={communication:e.communication,equipmentType:e.deviceType,values:e.equipmentArr,lyyDistributorId:e.lyyDistributorId,lyyGroupServices:e.selectList,billing:e.chargePattern},Array.isArray(e.equipmentArr)||(r.values=[e.equipmentArr]),e.clickDisabled=!0,setTimeout(function(){e.clickDisabled=!1},3e3),t.next=21,Object(m.b)(r);case 21:0===t.sent.result?(e.verfyCodeVisible=!1,e.$message({message:"设备注册记录可查看设备注册进度",type:"success"}),e.handleCancel()):e.$message({message:"设备注册失败，请重新选择设备",type:"error"});case 23:case"end":return t.stop()}},t,e)}))()},handleCancel:function(){window.history.go(-1)}}},b=(a("i/up"),a("ZrdR")),v=Object(b.a)(f,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-area"},[a("h1",{staticStyle:{margin:"10px 0px"}},[e._v("\n    注册设备：已选"+e._s(e.equipmentArr.length)+"台；设备类型："+e._s(e._f("deviceFilter")(e.deviceType))+"；通信方式："+e._s(e._f("communicationFilter")(e.communication))+"\n    "),2==e.communication?a("span",[e._v(";计费方式:"+e._s(e.chargePatternText))]):e._e()]),e._v(" "),a("el-form",{attrs:{inline:!0,"label-width":"100px","label-position":"left"}},[a("el-form-item",{attrs:{label:"选择绑定商家"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择",filterable:""},model:{value:e.lyyDistributorId,callback:function(t){e.lyyDistributorId=t},expression:"lyyDistributorId"}},e._l(e.merchantList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.adOrgId}})}))],1)],1),e._v(" "),a("div",{staticClass:"table-title-info"},[a("span",[e._v("选择服务套餐")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveModal}},[e._v("添加其他套餐")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.list,border:"","highlight-current-row":"",height:"400"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._l(e.colums,function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.key,label:e.label,width:e.width,sortable:e.sortable,align:"center"}})})],2),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("div",{staticStyle:{color:"red","margin-bottom":"20px"}},[e._v("注：设备注册成功后，设备绑定在商家的默认场地下。")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:e.handleBatchSave}},[e._v("完成")])],1),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"编辑套餐服务",width:"35%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"baseInfoRules",staticStyle:{"margin-top":"20px"},attrs:{model:e.modalData,rules:e.baseInfoRules,"label-width":"120px","label-position":"right"}},[a("el-form-item",{attrs:{label:"套餐名称",prop:"description"}},[a("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入套餐名称",maxlength:"10"},model:{value:e.modalData.description,callback:function(t){e.$set(e.modalData,"description",t)},expression:"modalData.description"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"价格(元)",prop:"price"}},[a("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入价格",type:"number",maxlength:"16",clearable:""},model:{value:e.modalData.price,callback:function(t){e.$set(e.modalData,"price",t)},expression:"modalData.price"}})],1),e._v(" "),"ELEC"==e.chargePattern?a("el-form-item",{key:"ELEC",attrs:{label:"电量(度)",prop:"electric"}},[a("el-input",{key:"2",staticClass:"input-300",attrs:{placeholder:"请输入电量",type:"tel",clearable:""},model:{value:e.modalData.electric,callback:function(t){e.$set(e.modalData,"electric",t)},expression:"modalData.electric"}})],1):e._e(),e._v(" "),"ELEC"!==e.chargePattern?a("el-form-item",{key:"TIME",attrs:{label:"时长(分钟)",prop:"serviceTime"}},[a("el-input",{key:"1",staticClass:"input-300",attrs:{placeholder:"请输入时长",type:"tel",maxlength:"6",clearable:""},model:{value:e.modalData.serviceTime,callback:function(t){e.$set(e.modalData,"serviceTime",t)},expression:"modalData.serviceTime"}})],1):e._e(),e._v(" "),"1"==e.communication?[a("el-form-item",{attrs:{label:"模拟投币数",prop:"coins"}},[a("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入模拟投币数",type:"number",maxlength:"4",clearable:""},model:{value:e.modalData.coins,callback:function(t){e.$set(e.modalData,"coins",t)},expression:"modalData.coins"}})],1)]:e._e()],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("保存并使用")])],1)],1),e._v(" "),a("verfyCode",{attrs:{"phone-number":e.phoneNumber,name:e.name},on:{"on-OK":e.handleBatchSave},model:{value:e.verfyCodeVisible,callback:function(t){e.verfyCodeVisible=t},expression:"verfyCodeVisible"}})],1)},[],!1,null,null,null);v.options.__file="register.vue";t.default=v.exports},th1P:function(e,t,a){}}]);