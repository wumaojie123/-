(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7462"],{"5I/0":function(e,t,i){},B5LO:function(e,t,i){"use strict";i.d(t,"e",function(){return r}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o}),i.d(t,"d",function(){return s}),i.d(t,"a",function(){return l});var a=i("Yfch"),r=function(e,t,i){if(!t||t&&!Object(a.d)(t))return i(new Error("请输入正确的11位手机号码"));i()},n=function(e,t,i){if(t&&!/^[A-Za-z0-9]{6,16}$/.test(t))return i(new Error("请输入6-16位的数字或字母"));i()},o=function(e,t,i){if(!/^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/.test(t)||t>1e4)return i(new Error("价格必须为大于0的正数,价格需小于10000,最多保留2位小数"));i()},s=function(e,t,i){if(!/^([1-9][0-9]*)$/.test(t)||t>1440)return i(new Error("服务时间必须为大于0的小于等于1440(24小时)正整数"));i()},l=function(e,t,i){if(!/^([1-9][0-9]*)$/.test(t)||0===t||t>1e4)return i(new Error("模拟投币数必须为大于0的整数"));i()}},"i/up":function(e,t,i){"use strict";var a=i("5I/0");i.n(a).a},"mG/D":function(e,t,i){"use strict";i.d(t,"b",function(){return a}),i.d(t,"c",function(){return r}),i.d(t,"a",function(){return n});var a=[{value:"CDZ",label:"充电桩"}],r={CDZ:"充电桩"},n={0:"无",1:"脉冲",2:"串口"}},qBRV:function(e,t,i){"use strict";i.r(t);var a=i("jWXv"),r=i.n(a),n=i("rfXi"),o=i.n(n),s=(i("gDS+"),i("14Xm")),l=i.n(s),c=i("D3Ub"),u=i.n(c),m=i("qpgI"),d=i("B5LO"),p=i("mG/D"),f={components:{verfyCode:i("YKrQ").default},filters:{deviceFilter:function(e){return p.c[e]},communicationFilter:function(e){return p.a[e]}},data:function(){return{lyyDistributorId:"",list:[],colums:[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"serviceTime",label:"时长(分钟)"},{key:"coins",label:"模拟投币数"}],pageInfo:{total:0},selectList:[],dialogFormVisible:!1,deviceType:"",equipmentArr:[],communication:"",modalData:{description:"",price:"",coins:"",serviceTime:""},merchantList:[],baseInfoRules:{description:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],serviceTime:[{required:!0,validator:d.d,trigger:"blur"}],coins:[{required:!0,validator:d.a,trigger:"blur"}],price:[{required:!0,validator:d.c,trigger:"blur"}]},clickDisabled:!1,verfyCodeVisible:!1,phoneNumber:"",name:""}},created:function(){this.deviceType=this.$route.query.deviceType,this.equipmentArr=this.$route.query.equipmentArr,this.communication=this.$route.query.communication,this.phoneNumber=this.$route.query.phoneNumber,this.name=this.$route.query.name,2==this.communication&&(this.colums=[{key:"description",label:"套餐名称"},{key:"price",label:"价格(元)"},{key:"serviceTime",label:"时长(分钟)"}]),this.queryList(),this.getMerchantList()},methods:{queryList:function(){var e=this;return u()(l.a.mark(function t(){var i,a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.list=[],i={communication:e.communication,equipmentType:e.deviceType,pageSize:400,pageIndex:1},t.next=4,Object(m.a)(i);case 4:0===(a=t.sent).result&&(e.listLoading=!1,a.data?(e.list=a.data.items||[],e.pageInfo.total=a.data.total||0):e.pageInfo.total=0);case 6:case"end":return t.stop()}},t,e)}))()},getMerchantList:function(){var e=this;return u()(l.a.mark(function t(){var i,a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.h)();case 2:0===(i=t.sent).result&&(a=(a=i.data||[]).map(function(e){return e.label=e.account+" "+e.name,e}),e.merchantList=a);case 4:case"end":return t.stop()}},t,e)}))()},handleSelectionChange:function(e){this.selectList=e},handleSaveModal:function(){this.dialogFormVisible=!0,this.modalData={description:"",price:"",coins:"",serviceTime:""}},handleSave:function(){var e=this;this.$refs.baseInfoRules.validate(function(t){if(!t)return!1;if(e.list.some(function(t){return 1===e.communication&&parseInt(t.coins,10)===parseInt(e.modalData.coins,10)||2===e.communication&&parseInt(t.serviceTime,10)===parseInt(e.modalData.serviceTime,10)})){var i="";return 1===e.communication?i="模拟投币数不可重复":2===e.communication&&(i="时长不能重复"),void e.$message({message:i,type:"error"})}2===e.communication&&(e.modalData.coins=e.modalData.serviceTime),e.list=[e.modalData].concat(e.list),e.selectList.push(e.modalData),e.dialogFormVisible=!1})},isRepeat:function(){var e=this,t=[];return this.selectList.forEach(function(i){2===e.communication?t.push(i.serviceTime):1===e.communication&&t.push(i.coins)}),t.length===o()(new r.a(t)).length},handleBatchSaveBefore:function(){var e=this;if(0!==this.selectList.length)if(this.lyyDistributorId)if(this.isRepeat()){var t=this.merchantList.filter(function(t){return t.adOrgId===e.lyyDistributorId})[0];this.phoneNumber=t.account,this.name=t.name,this.verfyCodeVisible=!0}else this.$message({message:"服务套餐不可重复",type:"error"});else this.$message({message:"请选择要绑定的商家",type:"error"});else this.$message({message:"请至少选择一个服务套餐",type:"error"})},handleBatchSave:function(){var e=this;return u()(l.a.mark(function t(){var i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.clickDisabled){t.next=2;break}return t.abrupt("return");case 2:return i={communication:e.communication,equipmentType:e.deviceType,values:e.equipmentArr,lyyDistributorId:e.lyyDistributorId,lyyGroupServices:e.selectList},Array.isArray(e.equipmentArr)||(i.values=[e.equipmentArr]),e.clickDisabled=!0,setTimeout(function(){e.clickDisabled=!1},3e3),t.next=8,Object(m.b)(i);case 8:0===t.sent.result?(e.verfyCodeVisible=!1,e.$message({message:"设备注册记录可查看设备注册进度",type:"success"}),e.handleCancel()):e.$message({message:"设备注册失败，请重新选择设备",type:"error"});case 10:case"end":return t.stop()}},t,e)}))()},handleCancel:function(){window.history.go(-1)}}},h=(i("i/up"),i("KHd+")),v=Object(h.a)(f,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content-area"},[i("h1",{staticStyle:{margin:"10px 0px"}},[e._v("注册设备：已选"+e._s(e.equipmentArr.length)+"台；设备类型："+e._s(e._f("deviceFilter")(e.deviceType))+"；通信方式："+e._s(e._f("communicationFilter")(e.communication)))]),e._v(" "),i("el-form",{attrs:{inline:!0,"label-width":"100px","label-position":"left"}},[i("el-form-item",{attrs:{label:"选择绑定商家"}},[i("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择",filterable:""},model:{value:e.lyyDistributorId,callback:function(t){e.lyyDistributorId=t},expression:"lyyDistributorId"}},e._l(e.merchantList,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.adOrgId}})}))],1)],1),e._v(" "),i("div",{staticClass:"table-title-info"},[i("span",[e._v("选择服务套餐")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveModal}},[e._v("添加其他套餐")])],1),e._v(" "),i("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.list,border:"","highlight-current-row":"",height:"400"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._l(e.colums,function(e,t){return i("el-table-column",{key:t,attrs:{prop:e.key,label:e.label,width:e.width,sortable:e.sortable,align:"center"}})})],2),e._v(" "),i("el-pagination",{attrs:{total:e.pageInfo.total,"current-page":e.pageInfo.currPage,background:"",layout:"total, pager"}}),e._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("div",{staticStyle:{color:"red","margin-bottom":"20px"}},[e._v("注：设备注册成功后，设备绑定在商家的默认场地下。")]),e._v(" "),i("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),i("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:e.handleBatchSave}},[e._v("完成")])],1),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"编辑套餐服务",width:"35%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"baseInfoRules",staticStyle:{"margin-top":"20px"},attrs:{model:e.modalData,rules:e.baseInfoRules,"label-width":"120px","label-position":"right"}},[i("el-form-item",{attrs:{label:"套餐名称",prop:"description"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入套餐名称",maxlength:"10"},model:{value:e.modalData.description,callback:function(t){e.$set(e.modalData,"description",t)},expression:"modalData.description"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"价格(元)",prop:"price"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入价格",type:"number",maxlength:"16",clearable:""},model:{value:e.modalData.price,callback:function(t){e.$set(e.modalData,"price",t)},expression:"modalData.price"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"时长(分钟)",prop:"serviceTime"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入时长",type:"tel",maxlength:"6",clearable:""},model:{value:e.modalData.serviceTime,callback:function(t){e.$set(e.modalData,"serviceTime",t)},expression:"modalData.serviceTime"}})],1),e._v(" "),"1"==e.communication?[i("el-form-item",{attrs:{label:"模拟投币数",prop:"coins"}},[i("el-input",{staticClass:"input-300",attrs:{placeholder:"请输入模拟投币数",type:"number",maxlength:"4",clearable:""},model:{value:e.modalData.coins,callback:function(t){e.$set(e.modalData,"coins",t)},expression:"modalData.coins"}})],1)]:e._e()],2),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("保存并使用")])],1)],1),e._v(" "),i("verfyCode",{attrs:{"phone-number":e.phoneNumber,name:e.name},on:{"on-OK":e.handleBatchSave},model:{value:e.verfyCodeVisible,callback:function(t){e.verfyCodeVisible=t},expression:"verfyCodeVisible"}})],1)},[],!1,null,null,null);v.options.__file="register.vue";t.default=v.exports}}]);